<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Prices</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            margin-top: 30px;
        }

        .card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .table th,
        .table td {
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2 class="text-center mb-4">Market Price data</h2>

        <a class="text mb-4" href="{{ url_for('dashboard') }}">Go to Dashboard </a>
        <div class="card p-4">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="state" class="form-label">State</label>
                    <select id="state" class="form-select" onchange="filterData()">
                        <option value="">All States</option>
                        {% for state in states %}
                        <option value="{{ state }}">{{ state }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="district" class="form-label">District</label>
                    <select id="district" class="form-select" onchange="filterData()">
                        <option value="">All Districts</option>
                        {% for district in districts %}
                        <option value="{{ district }}">{{ district }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="commodity" class="form-label">Commodity</label>
                    <select id="commodity" class="form-select" onchange="filterData()">
                        <option value="">All Commodities</option>
                        {% for commodity in commodities %}
                        <option value="{{ commodity }}">{{ commodity }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <table class="table table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>State</th>
                        <th>District</th>
                        <th>Market</th>
                        <th>Commodity</th>
                        <th>Variety</th>
                        <th>Min Price (₹)</th>
                        <th>Max Price (₹)</th>
                        <th>Modal Price (₹)</th>
                    </tr>
                </thead>
                <tbody id="market-table">
                    {% if market_data %}
                    {% for item in market_data %}
                    <tr>
                        <td>{{ item.state }}</td>
                        <td>{{ item.district }}</td>
                        <td>{{ item.market }}</td>
                        <td>{{ item.commodity }}</td>
                        <td>{{ item.variety }}</td>
                        <td>{{ item.min_price }}</td>
                        <td>{{ item.max_price }}</td>
                        <td>{{ item.modal_price }}</td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="8" class="text-center">No data available</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Store the original market data from the template
        const allMarketData = {{ market_data| tojson }};

        // Function to filter data based on the selected filters
        function filterData() {
            // Get the selected filter values
            const state = document.getElementById('state').value;
            const district = document.getElementById('district').value;
            const commodity = document.getElementById('commodity').value;

            // Filter the data based on selected values
            let filteredData = allMarketData;

            if (state) {
                filteredData = filteredData.filter(item => item.state.toLowerCase() === state.toLowerCase());
            }
            if (district) {
                filteredData = filteredData.filter(item => item.district.toLowerCase() === district.toLowerCase());
            }
            if (commodity) {
                filteredData = filteredData.filter(item => item.commodity.toLowerCase() === commodity.toLowerCase());
            }

            // Update the table with the filtered data
            updateTable(filteredData);
        }

        // Function to update the market table with filtered data
        function updateTable(data) {
            const tableBody = document.getElementById('market-table');
            tableBody.innerHTML = ''; // Clear existing rows

            if (data.length > 0) {
                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.state}</td>
                        <td>${item.district}</td>
                        <td>${item.market}</td>
                        <td>${item.commodity}</td>
                        <td>${item.variety}</td>
                        <td>${item.min_price}</td>
                        <td>${item.max_price}</td>
                        <td>${item.modal_price}</td>
                    `;
                    tableBody.appendChild(row);
                });
            } else {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="8" class="text-center">No data available</td>';
                tableBody.appendChild(row);
            }
        }

        // Initial population of the table
        updateTable(allMarketData);
    </script>

</body>

</html>